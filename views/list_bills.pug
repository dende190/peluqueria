extends layout_dashboard
block content
    .list-balance
        h1 Resumen de las Facturas
        .d-flex
            .item-balance
                p#count-balance
                span
                    | COBROS
            .item-balance
                p#subtotal-balance
                span
                    | IMPORTE
            .item-balance
                p#taxes-balance
                span
                    | IMPUESTOS
            .item-balance
                p#total-balance
                span
                    | TOTAL
    .container-list-bill
        .card
            .card-body
                table#table-bills.table
                    thead
                        td 
                            strong Fecha de Cobro
                        td 
                            strong Cliente
                        td 
                            strong Cobrador
                        td 
                            strong Forma de Pago
                        td 
                            strong Total
append scripts 
    script.
        function getBalanceSummary() {
            fetch('/summary-bills')
            .then(function(response) {
                return response.json();
            })
            .then(function(data) {
                console.log(data)
                let balance  = data[0]
                $('#count-balance').html('$' + balance.number_bills.toLocaleString())
                $('#subtotal-balance').html('$' + balance.subtotal_price.toLocaleString())
                $('#taxes-balance').html('$' + balance.total_taxes.toLocaleString())
                $('#total-balance').html('$' + balance.total_price.toLocaleString())
            })
            .catch(error => console.error('Error:', error))
        }
        $(document).ready(function(){
            let billsTable = $('#table-bills').dataTable({
                "ajax": "/today-bills",
                "columns": [
                    {
                        "data": "date",
                        "render": function(data, type, row) {
                            return moment(data).format("LLL")
                        }
                    },
                    {
                        "data": "common_client",
                        "render": function(data,type,row) {
                            return `${data[0].first_name} ${data[0].last_name}`
                        }
                    },
                    {
                        "data": "common_user",
                        "render": function(data,type,row) {
                            return `${data[0].first_name} ${data[0].last_name}`
                        }
                    },
                    {
                        "data": "method_pay",
                        "render": function(data, type, row){
                            if(data == 'cash') {
                                return `Efectivo`
                            } else {
                                return `Targeta de Credito`
                            }
                        }
                    },
                    {
                        "data": "total_price",
                        "render": function(data, type, row){
                            return '$' + parseFloat(data).toLocaleString()
                        }
                    },
                ],
                "language": spanishDataTable,
            })

            getBalanceSummary()

        })

